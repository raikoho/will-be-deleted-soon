This lesson is going to cover the seventh stage in the MITRE ATT&CK framework, [Discovery](https://attack.mitre.org/tactics/TA0007). These techniques are used to describe ways that adversaries will collect more information about the network they’re in and other systems that are present. Adversaries should spend a good deal of time at this stage, quietly watching what is happening around them so they can take further actions and ensure that they remain stealthy, attempting to blend into ‘normal’ network activity. At the time of writing currently includes 24 top-level techniques. **We will be looking at the following:**

- [**Account Discovery**](https://attack.mitre.org/techniques/T1087/)
- [**Network Service Scanning**](https://attack.mitre.org/techniques/T1046/)
- [**File and Directory Discovery**](https://attack.mitre.org/techniques/T1083/)

---
## Account Discovery

[**MITRE Technique T1087**](https://attack.mitre.org/techniques/T1087/)

Once an attacker has a foothold in a system the next logical step is to identify existing accounts so they can plan privilege escalation and lateral movement activities. The immediate choice is to look what accounts are found within the operating system, but additional accounts could include any logged-in email accounts and web services, from Outlook to Facebook. All of these could provide valuable information but also allow follow-up attacks such as internal spear phishing and social engineering.

This technique includes 4 sub-technique which we’ll go into more detail below.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/1fd3475e61c15ccc15c2fe52d8376876d81e65105f29bd94f8ed97579274364bb004bcbd7f936a1a888f40b86778.png)

- [**Local Accounts**](https://attack.mitre.org/techniques/T1087/001/) **–** Attackers may attempt to get a listing of local accounts using commands such as `net user` and `net localgroup` of the [Net](https://attack.mitre.org/software/S0039) utility and `id` and `groups`on macOS and Linux can list local users and groups. On Linux, local users can also be enumerated through reading the `/etc/passwd` file using commands such as `cat`, `strings`, and `head`.

- [**Domain Accounts**](https://attack.mitre.org/techniques/T1087/002/) **–** Attackers may attempt to get a listing of domain accounts using commands such as `net user /domain` and `net group /domain` of the [Net](https://attack.mitre.org/software/S0039) utility, `dscacheutil -q group`on macOS, and `ldapsearch` on Linux can list domain users and groups.

- [**Email Accounts**](https://attack.mitre.org/techniques/T1087/003/) **–** Attackers may attempt to get a listing of email addresses and accounts using techniques such as dumping Exchange address lists. It’s worth mentioning that this is what Emotet does when it infects a system, using this technique to scrape email addresses so it can send malicious emails from the compromised email account to any contacts or recent recipients.

![](https://wp.securityblue.team/wp-content/uploads/2020/09/Screenshot-2020-09-06-at-15.20.40.png)

- [**Cloud Accounts**](https://attack.mitre.org/techniques/T1087/004/) **–** Attackers may attempt to get a listing of cloud accounts that are configured by an organization for use by users, remote support, services, or for the administration of resources within a cloud environment. This can be achieved by navigating to popular console windows for AWS or Azure through the browser of the user to identify any cached credentials to log in to these services.

Moving down to the Mitigations table on the main technique there is only one suggestion listed, which is to disable the registry key shown below to prevent administrator accounts from being enumerated, disclosing information such as their usernames. To disable this key across a large environment we can use [Group Policy Objects](https://docs.microsoft.com/en-us/previous-versions/windows/desktop/policy/group-policy-objects) to enforce the change across all domain users.

  
![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/ca43f51e552351c88815998be0010751cdc13908fb01e4c712895e92c8f0ed97a874268bc3d8c978bbc262d33b52.png) 

---

## Network Service Scanning

[**MITRE Technique T1046**](https://attack.mitre.org/techniques/T1046/)

Again, after gaining a foothold it's time for the attacker to expand their access to other systems. This can be achieved by scanning the network to identify other systems, what services they are running, and what versions are running so that the attacker can research for any applicable vulnerabilities that may help them gain initial access.

Looking at some examples in the Procedure Examples table, we can see at the bottom some references to two Groups (G0027, G0081), and three Software (S0341, S0117, S0412) entries. All of these have been known to conduct port scans to identify listening services on remote systems.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/b76061d515b1cb42d23419d278a881ac601c50a97535362e18a354a2c11d5bce0360881a2f869b1bfb1c33bb4b9c.png)

Looking at mitigations listed for this technique the first one is self explanatory - if the service doesn't need to be listening for remote connections, then turn it off! An attacker can't exploit something if it doesn't exist. Secondly, we can use a Network Intrusion Prevention system (IPS) or Detection system (IDS) which will inspect network traffic to identify suspicious or malicious patterns (we covered this earlier in the IR domain!). And finally, we are recommended to segregate our networks. By only permitting specific paths between our networks, if an attacker compromises an employee's laptop, they shouldn't be able to reach and scan a network that contains confidential databases.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/767504a6c2dbc211b874886495f675dd5dfcc2fec5deb1dc50b032ff07f1ef3b19690ed365f7596ef056bccc79d0.png)

---

## File and Directory Discovery

[**MITRE Technique 1083**](https://attack.mitre.org/techniques/T1083/)

Once on a system, the attacker will most likely search for files of value - anything from credentials to confidential documents, network diagrams pictures to emails. The process of moving through the targets filesystem and finding these documents comes under the Discovery Tactic.

Looking at some Procedure Examples, we can see that these three tools/software have the ability to read the filesystem to identify files and present the findings back to the attacker.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/00f5149242635d9bac1b01dca4f0ba6cf2fdbd30e4d5f8d2d0bb8967aac565eccada01045a4dca8bcc766b08e613.png)

Unfortunately, there are no Mitigation suggestions, as browsing the filesystem is normal system activity that enables users and programs to access files.

However, we do have some detection opportunities at both the command level, and process level. We can monitor for commands that are used to interact with the file system, such as ‘cd’ for change directory (move to another location in the file system), ‘dir’ for list directory (show all files in the current folder), ‘find’ for finding files based on file name, and others. On most systems these commands will never be run, such as corporate laptops, as users will access the filesystem using a graphical user interface, such as Windows Explorer.

We can also monitor for API calls and processes that are seen rapidly checking the file system to identify files.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/9a191a93dcbccb337f691a1199269760e679fe846e8eeaa95c4349d097bb67a2630a52bf2eaad0c2fb6129679fdf.png)