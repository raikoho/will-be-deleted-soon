This lesson is going to cover the ninth stage in the MITRE ATT&CK framework, [Collection](https://attack.mitre.org/tactics/TA0009/). 

These techniques are used to describe ways that adversaries will identify important files or information, collect them, and prepare them for data exfiltration. At the time of writing currently includes 16 top-level techniques. 

**We will be looking at the following:**

- [**Email Collection**](https://attack.mitre.org/techniques/T1114/)
- [**Audio Capture**](https://attack.mitre.org/techniques/T1123/)
- [**Screen Capture**](https://attack.mitre.org/techniques/T1113/)
- [**Data From Local System**](https://attack.mitre.org/techniques/T1005/)

## Email Collection

[**MITRE Technique T1114**](https://attack.mitre.org/techniques/T1114/)

Collecting emails from a target system seems like a great idea – these emails could give an insight into business operations, provide a list of valid internal email addresses for future spear phishing attacks or sell them for money on underground markets, collect email attachments that could include sensitive data, and much more. When considering email collection there’s three sub-technique that we need to consider:

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/dbc1558ed7c15bf5004d61575ea3e93069c17b4a49bbb73f5b6937784e911b2cbd80b10a9f5a66e2ff13e294b766.png)

- [**Local Email Collection**](https://attack.mitre.org/techniques/T1114/001/) **–** Attackers may target emails on the local system to identify and collect sensitive information. Files containing email data can be acquired from a user’s local system such as Outlook storage or cache files typically stored in `C:\Users\<username>\Documents\Outlook Files` or `C:\Users\<username>\AppData\Local\Microsoft\Outlook`.
- [**Remote Email Collection**](https://attack.mitre.org/techniques/T1114/002/) **–** Attackers may specifically target and pivot to an Exchange server or Office 365 to collect sensitive information. Using valid credentials the actor can interact directly with the Exchange server to poll information from within a network. The attack doesn’t always have to occur from within a network, as internet facing Exchange services or Office 365 can be accessed to read, send, save and delete emails.
- [**Email Forwarding Rule**](https://attack.mitre.org/techniques/T1114/003/) **–** Adversaries may setup email forwarding rules to collect sensitive information. Any emails that are sent to a user will be silently auto-forwarded to an attacker-owned email address presenting a data leak that will continue to give the adversary access to email messages even if they have lost access to the network. This could result in sensitive data exposure which could also be used for social engineering and spear phishing attacks in the future.

Using multi-factor authentication (MFA) can prevent access to an account where a malicious actor has discovered the valid username and password combination. Although there are ways MFA can be bypassed it adds more work for the adversary and gives us more time to catch them. We could also consider encrypting our emails or sensitive documents and only share the decryption key with trusted parties via alternative communication methods. And finally enterprise-grade email solutions could have functionality to audit auto-forwarding rules to see if any have been created to send mail to non-domain mailboxes and generate an alert or report for further investigation.
  
![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/4a795377c47ce761c239d47e45bc3a09161cb55440d3331c1a24a346e1e3e9066fa2259bc72887068ed75086888c.png)

In regard to detecting this activity we have a number of options that we can choose from. Unusual processes accessing an email server or application could suggest an adversary is attempt to connect, or a user that works from 9 AM to 5 PM logging in at 1:30 AM on a Saturday and opening their email application is very unusual and is potentially a sign of malicious activity. Also monitor for unusual PowerShell, WMI, and CMD commands being executed from a user’s account.
  
![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/ee68cfa415e2562914105855f3643cf2cbc68bce2ed7524daf3845517568ffc3014a9a7d8a7eac282fe2b5df55f5.png)

## Audio Capture

[**MITRE Technique T1123**](https://attack.mitre.org/techniques/T1123/)

An attacker can utilise peripheral devices such as plugged-in microphones, headsets or webcams to collect audio from users that are interacting with the system. Recording of system audio can also result in the ability to capture conversations via Voice-over IP (VOIP) applications such as Skype, Webex, and Teams.

APT37 has been documented using audio capture software known as SOUNDWAVE to record microphone input from an infected system. The Bandook malware has modules that can allow the software to capture audio, the same with Cobian RAT, Attor, and Cadelspy.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/83e8c5815b94c0f22808f0651bf724eff22b671e4f78f6106fe0e80445395d0173caca1435b0ed8b5e54fd1bd41d.png)

It is not possible to completely mitigate this technique because using system audio is practically a necessity. Focusing on detection we can monitor API calls that are related to audio capture, but this would generate a high volume of false positives because it could be legitimate activity. Process monitoring should be conducted to identify any unusual processes are attempting to access the microphone on a system along with file creation that is likely audio-related.
  
![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/efd15939cfda64af23cec3701cc6f305052d195e83fa48e0de60f278beddb6abb923c4b2e0efcb6e0a80a9db590d.png)

## Screen Capture

[**MITRE Technique T1133**](https://attack.mitre.org/techniques/T1113/)

Taking screen captures from the system can help to gather information over a long period of time, and this technique will typically be deployed soon after a system has been compromised, giving it a good chance of collecting valuable information or build up a profile of the user’s day-to-day habits. Taking a screenshot can also be achieved through native utilities or API calls, such as `CopyFromScreen`, `xwd`, or `screencapture` (but this isn’t standard behaviour, so we can monitor on these commands!).

The first entry in the Procedure Examples table for this technique is the famous Agent Tesla remote access trojan (RAT). This tool has the ability to take screenshots at regular intervals which could disclose information from open documents or web browsing activity. APT28 and APT39 have been known to collect screenshots during their cyber operations as an information collection technique. Aria-body, a malicious program, also has the ability to capture screenshots.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/b3175c2f9b3288af805ef66de79f700141d3184fa5f1b6e4eaa1ce1acc8010ad94a27e3b88cc9fa3b1c9836d5956.png)

Mitigating these actions isn’t feasible as it can be used for legitimate purposes, and instead we should focus on detection. We can monitor for unusual API calls that are related with taking screenshots, but this could still generate a large number of false positives. We should find ways to link this with other activity to reduce the number of false positives and build a stronger detection capability.
  
![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/ef6e44f57e052413ab772d00a4752bb6ff5336c1af7e7712ef61e1dbb440a0b611feb5edfd69b0a5ed1685785b07.png)

## Data From Local System

[**MITRE Technique T1005**](https://attack.mitre.org/techniques/T1005/)

Attackers may search through any attached local or networked drives to find files of interest and sensitive data prior to Exfiltration. This can be anything from local databases to coding projects, sensitive documents to user’s files. Identifying such files can be achieved by using an interpreter such as the CMD on Windows systems, making use of commands such as `find`, `tree`, `locate`, and `dir`. Alternatively attackers can make use of tools that can perform [Automated Collection](https://attack.mitre.org/techniques/T1119) on the local system.

The Procedure Examples table for this technique has a lot of generic entries because almost every threat actor is going to want to identify and exfiltrate interesting files from a compromised system. We can see that APT28 has previously exfiltrated internal documents from systems under their control and using [Forfiles](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/forfiles) to prepare files for exfiltration. GravityRAT (remote access trojan) is known to steal files with specific file extensions which are typically widely used within businesses and enterprises. The same goes for Inception which looks for files with specific extensions and sends them back to the attacker.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/11d67b555faed9a75162e02b0dde0fc9060f5d30d80f72485cd6a7bbc97f4a43174795afe49192347dbe6ad6533b.png)

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/9ee0ea350bcc5ad1a6bb5b57297b5907508a5fd3b820df6fc53ff057f8e62efba26c1415577deab36061e80867d4.png)

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/c8c1802e3ea4d0384f6c6e7778fe2f23964ce3af4e30011cc0cbb264a919b9f4e7e2d795e88bbea9c414a7d5fd75.png)

It’s hard to differentiate between legitimate and malicious activity because it won’t immediately look any different than expected user activity accessing and changing user-generated files on their systems. To detect this activity we should monitor for excessive usage of commands in CMD and PowerShell that may represent a malicious actor preparing files for exfiltration.
  
![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/d2ad53ff5cabbbaa2abd3d5e90dcf0e1789a7002253e3c78ca8545568394400ab530717d5e5096e65d7844feb761.png)