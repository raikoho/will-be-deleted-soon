In the lab scenario on the Instructions page we're told to scope this investigation to fortigate_utm logs only. We are also told to search for two strings, our website name "imreallynotbatman.com", and “vulnerability” to help identify if our site is being scanned by an attacker.

To get Splunk ready, we'll open a Terminal using the icon on the bottom toolbar and enter in the following command: `sudo systemctl start Splunkd`. After a minute we'll open Firefox and visit `127.0.0.1:8000`. Next we'll click on the ‘Search & Reporting’ app on the left-hand side of the Splunk homepage.

We need to make sure we can see all of the logs as they were generated back in 2020. To do this we'll click on the timeframe selector on the far right and select OTHER > All time on the right.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/6bc46e36ea3fa18a10dec6ca24f08fa8f399c8e162d4d6070f40ff7c5988078c8d4fb2f380fdef711b3659470f4e.PNG)

Whenever we conduct a search we want to start the query with `**index="botsv1"**` to ensure we are loading the right data.

We're ready to get started with the lab questions!

---

**Question 1 - What is the name of the web vulnerability scanner that is being used?**

There is a wide range of ways we can approach this investigation, as we are not provided with the pre-written search queries in this lab. Let's assume we're not familiar with Splunk, so we can't just write a perfect search to find this information instantly. Let's go step-by-step and build up our query!

First, we want to find events with the sourcetype fortiguate_utm, so we'll turn Event Sampling to 1:100 (as we don't want to search through every single log just to retrieve the sourcetype) and run a search for `index="botsv1"`.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/340d87b072f17044988fd32aec362cc2b7157dd5c36d7e18b6fb2404b00b82251cf3bf853c7fc74735266b3e9a93.PNG)

On the left-hand panel, we'll see ‘sourcetype’ under the ‘SELECTED FIELDS’ heading. After clicking on sourcetype we can see fortigate_utm is listed. Clicking on this will add that filter to our search query.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/c7905ee5c4dad4a409c0f7e43ba80536e0f7520798a49ca10f994d4a3c82412079219d712f350a52eefc7ae4f9dc.PNG) 

Our search query is now `index="botsv1" sourcetype=fortigate_utm`. Let's turn Event Sampling off (No Event Sampling) and wait for the search to finish.

Next we're looking for a field that will hold the domain we're looking for, imreallynotbatman.com. Scrolling down the Interesting Fields we find ‘url_domain’, and clicking on it shows the domain we're interested in. We can click the value to add it to our search.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/321697d54e5b42e5cf6a4f94c00d9d7845f41a131ee4cd1156a3580c068f3bc8db1cb9fd6e0335874cf6062ded1b.PNG)

`Our search query is now index="botsv1" sourcetype=fortigate_utm url_domain="imreallynotbatman.com"`. The final part the scenario told us about is including the string ‘vulnerability’. We can add this by simply writing vulnerability at the end of our search query, giving us a final query of `index="botsv1" sourcetype=fortigate_utm url_domain="imreallynotbatman.com" vulnerability`.

Going back to the question now that our query is built, looking at the Event Details panel we can see that the text ‘vulnerability’ is highlighted, showing us that two fields in these logs, ‘attack’ and ‘msg’ inform us that the traffic is being generated by the Acunetix Web Vulnerability Scanner.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/610c55257227c79c3274bf374d7cf3c245b1d78a481218de858b3761ea70ec21c918bb698b5841ebec98acee8047.PNG)

---

**Question 2 - What is the source IP of the vulnerability scanner, and therefore the attacker?**

Looking at the events our search has found, we can see that the field ‘srcip’ is being used by this log to hold the source IP address value.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/30d547554bf5d25916153b39057012d50dd4524af49ecf9e3b8f441ecee72f5c67074661b3ba9c438922a987b1d7.PNG)

---

**Question 3 - What is the destination IP? (the internal address for our web server)**

Looking at the events our search has found, we can see that the field ‘dstip’ is being used by the log to hold the destination IP address value.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/8efac2c45391bfaf7ce5a7aef57487c7c4c6726450099065a30bc8d740f101a875559f64d42a4e884dfa66901e0a.PNG)

---

**Question 4 - Fortigate UTM provides enrichment, and can tell us the source IP country based on a lookup. What country is the scanning IP associated with?**

Looking at the events our search has found, we can see that the field ‘srccountry’ is being used by this log to hold the source IP address country value.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/30d547554bf5d25916153b39057012d50dd4524af49ecf9e3b8f441ecee72f5c67074661b3ba9c438922a987b1d7.PNG)

---

**Question 5 - What is the timestamp in the first Fortigate UTM log referencing the vulnerability scan, on 8/10/16, in the format HH:MM:SS? (Use the log timestamp, not the Time column next to the event)**

Keeping the same search query, we want to sort these events based on the ‘time’ field within the logs. To do this, we'll use the ‘sort’ functionality in our query. All we need to do is add `| sort _time asc` to the end of our search, which will sort all the events in time ascending order, putting the first events at the top.

![](https://d2y9h8w1ydnujs.cloudfront.net/uploads/content/images/c66bc96c48234a69401c44081a785ad1f40e90aeca048bae157af921e6644501a466b4cd7f70427e203be83252ea.PNG)